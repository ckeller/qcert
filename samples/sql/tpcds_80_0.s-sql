(statements (query (with (as "ssr") (query (select (as "store_id") (ref "s_store_id") (as "sales") (function "sum" (ref "ss_ext_sales_price")) (as "returns") (function "sum" (coalesce (ref "sr_return_amt") 0)) (as "profit") (function "sum" (subtract (ref "ss_net_profit") (coalesce (ref "sr_net_loss") 0)))) (from (join (join (join (join (join (left) (on (and (equal (ref "ss_item_sk") (ref "sr_item_sk")) (equal (ref "ss_ticket_number") (ref "sr_ticket_number")))) (table "store_sales") (table "store_returns")) (table "date_dim")) (table "store")) (table "item")) (table "promotion"))) (where (and (and (and (and (and (and (equal (ref "ss_sold_date_sk") (ref "d_date_sk")) (isBetween (ref "d_date") (cast (as "DATE") "1998-08-04") (add (cast (as "DATE") "1998-08-04") (interval "30" (day))))) (equal (ref "ss_store_sk") (ref "s_store_sk"))) (equal (ref "ss_item_sk") (ref "i_item_sk"))) (greater_than (ref "i_current_price") 50)) (equal (ref "ss_promo_sk") (ref "p_promo_sk"))) (equal (ref "p_channel_tv") "N"))) (groupBy (ref "s_store_id")))) (with (as "csr") (query (select (as "catalog_page_id") (ref "cp_catalog_page_id") (as "sales") (function "sum" (ref "cs_ext_sales_price")) (as "returns") (function "sum" (coalesce (ref "cr_return_amount") 0)) (as "profit") (function "sum" (subtract (ref "cs_net_profit") (coalesce (ref "cr_net_loss") 0)))) (from (join (join (join (join (join (left) (on (and (equal (ref "cs_item_sk") (ref "cr_item_sk")) (equal (ref "cs_order_number") (ref "cr_order_number")))) (table "catalog_sales") (table "catalog_returns")) (table "date_dim")) (table "catalog_page")) (table "item")) (table "promotion"))) (where (and (and (and (and (and (and (equal (ref "cs_sold_date_sk") (ref "d_date_sk")) (isBetween (ref "d_date") (cast (as "DATE") "1998-08-04") (add (cast (as "DATE") "1998-08-04") (interval "30" (day))))) (equal (ref "cs_catalog_page_sk") (ref "cp_catalog_page_sk"))) (equal (ref "cs_item_sk") (ref "i_item_sk"))) (greater_than (ref "i_current_price") 50)) (equal (ref "cs_promo_sk") (ref "p_promo_sk"))) (equal (ref "p_channel_tv") "N"))) (groupBy (ref "cp_catalog_page_id")))) (with (as "wsr") (query (select (ref "web_site_id") (as "sales") (function "sum" (ref "ws_ext_sales_price")) (as "returns") (function "sum" (coalesce (ref "wr_return_amt") 0)) (as "profit") (function "sum" (subtract (ref "ws_net_profit") (coalesce (ref "wr_net_loss") 0)))) (from (join (join (join (join (join (left) (on (and (equal (ref "ws_item_sk") (ref "wr_item_sk")) (equal (ref "ws_order_number") (ref "wr_order_number")))) (table "web_sales") (table "web_returns")) (table "date_dim")) (table "web_site")) (table "item")) (table "promotion"))) (where (and (and (and (and (and (and (equal (ref "ws_sold_date_sk") (ref "d_date_sk")) (isBetween (ref "d_date") (cast (as "DATE") "1998-08-04") (add (cast (as "DATE") "1998-08-04") (interval "30" (day))))) (equal (ref "ws_web_site_sk") (ref "web_site_sk"))) (equal (ref "ws_item_sk") (ref "i_item_sk"))) (greater_than (ref "i_current_price") 50)) (equal (ref "ws_promo_sk") (ref "p_promo_sk"))) (equal (ref "p_channel_tv") "N"))) (groupBy (ref "web_site_id")))) (select (ref "channel") (ref "id") (as "sales") (function "sum" (ref "sales")) (as "returns") (function "sum" (ref "returns")) (as "profit") (function "sum" (ref "profit"))) (from (aliasAs "x" (query (union (union (query (select (as "channel") "store channel" (as "id") (function "concat" "store" (ref "store_id")) (ref "sales") (ref "returns") (ref "profit")) (from (table "ssr"))) (query (select (as "channel") "catalog channel" (as "id") (function "concat" "catalog_page" (ref "catalog_page_id")) (ref "sales") (ref "returns") (ref "profit")) (from (table "csr")))) (query (select (as "channel") "web channel" (as "id") (function "concat" "web_site" (ref "web_site_id")) (ref "sales") (ref "returns") (ref "profit")) (from (table "wsr"))))))) (groupBy (rollup "channel" "id")) (orderBy (ascending (ref "channel")) (ascending (ref "id")))))
