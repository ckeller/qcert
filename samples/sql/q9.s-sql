(query (select (ref "nation" ) (ref "o_year" ) (as "sum_profit") (function "sum" (ref "amount" ) ) ) (from (aliasAs "profit" (query (select (as "nation") (ref "n_name" ) (as "o_year") (extract (year) (ref "o_orderdate" ) ) (as "amount") (subtract (multiply (ref "l_extendedprice" ) (subtract 1 (ref "l_discount" ) ) ) (multiply (ref "ps_supplycost" ) (ref "l_quantity" ) ) ) ) (from (join (join (join (join (join (table "part" ) (table "supplier" ) ) (table "lineitem" ) ) (table "partsupp" ) ) (table "orders" ) ) (table "nation" ) ) ) (where (and (and (and (and (and (and (equal (ref "s_suppkey" ) (ref "l_suppkey" ) ) (equal (ref "ps_suppkey" ) (ref "l_suppkey" ) ) ) (equal (ref "ps_partkey" ) (ref "l_partkey" ) ) ) (equal (ref "p_partkey" ) (ref "l_partkey" ) ) ) (equal (ref "o_orderkey" ) (ref "l_orderkey" ) ) ) (equal (ref "s_nationkey" ) (ref "n_nationkey" ) ) ) (like (ref "p_name" ) "%green%" ) ) ) ) ) ) (groupBy (ref "nation" ) (ref "o_year" ) ) (orderBy (ascending (ref "nation" ) ) (descending (ref "o_year" ) ) ) ) 
