(statements (query (with (as "customer_total_return") (query (select (as "ctr_customer_sk") (ref "cr_returning_customer_sk") (as "ctr_state") (ref "ca_state") (as "ctr_total_return") (function "sum" (ref "cr_return_amt_inc_tax"))) (from (join (join (table "catalog_returns") (table "date_dim")) (table "customer_address"))) (where (and (and (equal (ref "cr_returned_date_sk") (ref "d_date_sk")) (equal (ref "d_year") 1998)) (equal (ref "cr_returning_addr_sk") (ref "ca_address_sk")))) (groupBy (ref "cr_returning_customer_sk") (ref "ca_state")))) (select (ref "c_customer_id") (ref "c_salutation") (ref "c_first_name") (ref "c_last_name") (ref "ca_street_number") (ref "ca_street_name") (ref "ca_street_type") (ref "ca_suite_number") (ref "ca_city") (ref "ca_county") (ref "ca_state") (ref "ca_zip") (ref "ca_country") (ref "ca_gmt_offset") (ref "ca_location_type") (ref "ctr_total_return")) (from (join (join (aliasAs "ctr1" (table "customer_total_return")) (table "customer_address")) (table "customer"))) (where (and (and (and (greater_than (deref "ctr_total_return" (ref "ctr1")) (query (select (multiply (function "avg" (ref "ctr_total_return")) 1.200000)) (from (aliasAs "ctr2" (table "customer_total_return"))) (where (equal (deref "ctr_state" (ref "ctr1")) (deref "ctr_state" (ref "ctr2")))))) (equal (ref "ca_address_sk") (ref "c_current_addr_sk"))) (equal (ref "ca_state") "IL")) (equal (deref "ctr_customer_sk" (ref "ctr1")) (ref "c_customer_sk")))) (orderBy (ascending (ref "c_customer_id")) (ascending (ref "c_salutation")) (ascending (ref "c_first_name")) (ascending (ref "c_last_name")) (ascending (ref "ca_street_number")) (ascending (ref "ca_street_name")) (ascending (ref "ca_street_type")) (ascending (ref "ca_suite_number")) (ascending (ref "ca_city")) (ascending (ref "ca_county")) (ascending (ref "ca_state")) (ascending (ref "ca_zip")) (ascending (ref "ca_country")) (ascending (ref "ca_gmt_offset")) (ascending (ref "ca_location_type")) (ascending (ref "ctr_total_return")))))
