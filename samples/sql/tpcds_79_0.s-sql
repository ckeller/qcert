(statements (query (select (ref "c_last_name") (ref "c_first_name") (function "substr" (ref "s_city") 1 30) (ref "ss_ticket_number") (ref "amt") (ref "profit")) (from (join (aliasAs "ms" (query (select (ref "ss_ticket_number") (ref "ss_customer_sk") (deref "s_city" (ref "store")) (as "amt") (function "sum" (ref "ss_coupon_amt")) (as "profit") (function "sum" (ref "ss_net_profit"))) (from (join (join (join (table "store_sales") (table "date_dim")) (table "store")) (table "household_demographics"))) (where (and (and (and (and (and (and (equal (deref "ss_sold_date_sk" (ref "store_sales")) (deref "d_date_sk" (ref "date_dim"))) (equal (deref "ss_store_sk" (ref "store_sales")) (deref "s_store_sk" (ref "store")))) (equal (deref "ss_hdemo_sk" (ref "store_sales")) (deref "hd_demo_sk" (ref "household_demographics")))) (or (equal (deref "hd_dep_count" (ref "household_demographics")) 8) (greater_than (deref "hd_vehicle_count" (ref "household_demographics")) 0))) (equal (deref "d_dow" (ref "date_dim")) 1)) (isIn (deref "d_year" (ref "date_dim")) (list 1998 (add 1998 1) (add 1998 2)))) (isBetween (deref "s_number_employees" (ref "store")) 200 295))) (groupBy (ref "ss_ticket_number") (ref "ss_customer_sk") (ref "ss_addr_sk") (deref "s_city" (ref "store"))))) (table "customer"))) (where (equal (ref "ss_customer_sk") (ref "c_customer_sk"))) (orderBy (ascending (ref "c_last_name")) (ascending (ref "c_first_name")) (ascending (function "substr" (ref "s_city") 1 30)) (ascending (ref "profit")))))
