(statements (query (union (distinct) (union (distinct) (query (select (as "channel") "web" (deref "item" (ref "web")) (deref "return_ratio" (ref "web")) (deref "return_rank" (ref "web")) (deref "currency_rank" (ref "web"))) (from (aliasAs "web" (query (select (ref "item") (ref "return_ratio") (ref "currency_ratio") (as "return_rank") (function (orderBy (ascending (ref "return_ratio"))) "rank") (as "currency_rank") (function (orderBy (ascending (ref "currency_ratio"))) "rank")) (from (aliasAs "in_web" (query (select (as "item") (deref "ws_item_sk" (ref "ws")) (as "return_ratio") (divide (cast (as "DEC(15,4)") (function "sum" (coalesce (deref "wr_return_quantity" (ref "wr")) 0))) (cast (as "DEC(15,4)") (function "sum" (coalesce (deref "ws_quantity" (ref "ws")) 0)))) (as "currency_ratio") (divide (cast (as "DEC(15,4)") (function "sum" (coalesce (deref "wr_return_amt" (ref "wr")) 0))) (cast (as "DEC(15,4)") (function "sum" (coalesce (deref "ws_net_paid" (ref "ws")) 0))))) (from (join (join (left) (on (and (equal (deref "ws_order_number" (ref "ws")) (deref "wr_order_number" (ref "wr"))) (equal (deref "ws_item_sk" (ref "ws")) (deref "wr_item_sk" (ref "wr"))))) (aliasAs "ws" (table "web_sales")) (aliasAs "wr" (table "web_returns"))) (table "date_dim"))) (where (and (and (and (and (and (and (greater_than (deref "wr_return_amt" (ref "wr")) 10000) (greater_than (deref "ws_net_profit" (ref "ws")) 1)) (greater_than (deref "ws_net_paid" (ref "ws")) 0)) (greater_than (deref "ws_quantity" (ref "ws")) 0)) (equal (ref "ws_sold_date_sk") (ref "d_date_sk"))) (equal (ref "d_year") 2000)) (equal (ref "d_moy") 12))) (groupBy (deref "ws_item_sk" (ref "ws"))))))))) (where (or (less_than_or_equal (deref "return_rank" (ref "web")) 10) (less_than_or_equal (deref "currency_rank" (ref "web")) 10)))) (query (select (as "channel") "catalog" (deref "item" (ref "catalog")) (deref "return_ratio" (ref "catalog")) (deref "return_rank" (ref "catalog")) (deref "currency_rank" (ref "catalog"))) (from (aliasAs "catalog" (query (select (ref "item") (ref "return_ratio") (ref "currency_ratio") (as "return_rank") (function (orderBy (ascending (ref "return_ratio"))) "rank") (as "currency_rank") (function (orderBy (ascending (ref "currency_ratio"))) "rank")) (from (aliasAs "in_cat" (query (select (as "item") (deref "cs_item_sk" (ref "cs")) (as "return_ratio") (divide (cast (as "DEC(15,4)") (function "sum" (coalesce (deref "cr_return_quantity" (ref "cr")) 0))) (cast (as "DEC(15,4)") (function "sum" (coalesce (deref "cs_quantity" (ref "cs")) 0)))) (as "currency_ratio") (divide (cast (as "DEC(15,4)") (function "sum" (coalesce (deref "cr_return_amount" (ref "cr")) 0))) (cast (as "DEC(15,4)") (function "sum" (coalesce (deref "cs_net_paid" (ref "cs")) 0))))) (from (join (join (left) (on (and (equal (deref "cs_order_number" (ref "cs")) (deref "cr_order_number" (ref "cr"))) (equal (deref "cs_item_sk" (ref "cs")) (deref "cr_item_sk" (ref "cr"))))) (aliasAs "cs" (table "catalog_sales")) (aliasAs "cr" (table "catalog_returns"))) (table "date_dim"))) (where (and (and (and (and (and (and (greater_than (deref "cr_return_amount" (ref "cr")) 10000) (greater_than (deref "cs_net_profit" (ref "cs")) 1)) (greater_than (deref "cs_net_paid" (ref "cs")) 0)) (greater_than (deref "cs_quantity" (ref "cs")) 0)) (equal (ref "cs_sold_date_sk") (ref "d_date_sk"))) (equal (ref "d_year") 2000)) (equal (ref "d_moy") 12))) (groupBy (deref "cs_item_sk" (ref "cs"))))))))) (where (or (less_than_or_equal (deref "return_rank" (ref "catalog")) 10) (less_than_or_equal (deref "currency_rank" (ref "catalog")) 10))))) (query (select (as "channel") "store" (deref "item" (ref "store")) (deref "return_ratio" (ref "store")) (deref "return_rank" (ref "store")) (deref "currency_rank" (ref "store"))) (from (aliasAs "store" (query (select (ref "item") (ref "return_ratio") (ref "currency_ratio") (as "return_rank") (function (orderBy (ascending (ref "return_ratio"))) "rank") (as "currency_rank") (function (orderBy (ascending (ref "currency_ratio"))) "rank")) (from (aliasAs "in_store" (query (select (as "item") (deref "ss_item_sk" (ref "sts")) (as "return_ratio") (divide (cast (as "DEC(15,4)") (function "sum" (coalesce (deref "sr_return_quantity" (ref "sr")) 0))) (cast (as "DEC(15,4)") (function "sum" (coalesce (deref "ss_quantity" (ref "sts")) 0)))) (as "currency_ratio") (divide (cast (as "DEC(15,4)") (function "sum" (coalesce (deref "sr_return_amt" (ref "sr")) 0))) (cast (as "DEC(15,4)") (function "sum" (coalesce (deref "ss_net_paid" (ref "sts")) 0))))) (from (join (join (left) (on (and (equal (deref "ss_ticket_number" (ref "sts")) (deref "sr_ticket_number" (ref "sr"))) (equal (deref "ss_item_sk" (ref "sts")) (deref "sr_item_sk" (ref "sr"))))) (aliasAs "sts" (table "store_sales")) (aliasAs "sr" (table "store_returns"))) (table "date_dim"))) (where (and (and (and (and (and (and (greater_than (deref "sr_return_amt" (ref "sr")) 10000) (greater_than (deref "ss_net_profit" (ref "sts")) 1)) (greater_than (deref "ss_net_paid" (ref "sts")) 0)) (greater_than (deref "ss_quantity" (ref "sts")) 0)) (equal (ref "ss_sold_date_sk") (ref "d_date_sk"))) (equal (ref "d_year") 2000)) (equal (ref "d_moy") 12))) (groupBy (deref "ss_item_sk" (ref "sts"))))))))) (where (or (less_than_or_equal (deref "return_rank" (ref "store")) 10) (less_than_or_equal (deref "currency_rank" (ref "store")) 10))))) (limit "100") (orderBy (ascending 1) (ascending 4) (ascending 5))))
