(statements (query (with (as "ssr") (query (select (ref "s_store_id") (as "sales") (function "sum" (ref "sales_price")) (as "profit") (function "sum" (ref "profit")) (as "returns") (function "sum" (ref "return_amt")) (as "profit_loss") (function "sum" (ref "net_loss"))) (from (join (join (aliasAs "salesreturns" (query (union (query (select (as "store_sk") (ref "ss_store_sk") (as "date_sk") (ref "ss_sold_date_sk") (as "sales_price") (ref "ss_ext_sales_price") (as "profit") (ref "ss_net_profit") (as "return_amt") (cast (as "DECIMAL(7,2)") 0) (as "net_loss") (cast (as "DECIMAL(7,2)") 0)) (from (table "store_sales"))) (query (select (as "store_sk") (ref "sr_store_sk") (as "date_sk") (ref "sr_returned_date_sk") (as "sales_price") (cast (as "DECIMAL(7,2)") 0) (as "profit") (cast (as "DECIMAL(7,2)") 0) (as "return_amt") (ref "sr_return_amt") (as "net_loss") (ref "sr_net_loss")) (from (table "store_returns")))))) (table "date_dim")) (table "store"))) (where (and (and (equal (ref "date_sk") (ref "d_date_sk")) (isBetween (ref "d_date") (cast (as "DATE") "1998-08-04") (add (cast (as "DATE") "1998-08-04") (interval "14" (day))))) (equal (ref "store_sk") (ref "s_store_sk")))) (groupBy (ref "s_store_id")))) (with (as "csr") (query (select (ref "cp_catalog_page_id") (as "sales") (function "sum" (ref "sales_price")) (as "profit") (function "sum" (ref "profit")) (as "returns") (function "sum" (ref "return_amt")) (as "profit_loss") (function "sum" (ref "net_loss"))) (from (join (join (aliasAs "salesreturns" (query (union (query (select (as "page_sk") (ref "cs_catalog_page_sk") (as "date_sk") (ref "cs_sold_date_sk") (as "sales_price") (ref "cs_ext_sales_price") (as "profit") (ref "cs_net_profit") (as "return_amt") (cast (as "DECIMAL(7,2)") 0) (as "net_loss") (cast (as "DECIMAL(7,2)") 0)) (from (table "catalog_sales"))) (query (select (as "page_sk") (ref "cr_catalog_page_sk") (as "date_sk") (ref "cr_returned_date_sk") (as "sales_price") (cast (as "DECIMAL(7,2)") 0) (as "profit") (cast (as "DECIMAL(7,2)") 0) (as "return_amt") (ref "cr_return_amount") (as "net_loss") (ref "cr_net_loss")) (from (table "catalog_returns")))))) (table "date_dim")) (table "catalog_page"))) (where (and (and (equal (ref "date_sk") (ref "d_date_sk")) (isBetween (ref "d_date") (cast (as "DATE") "1998-08-04") (add (cast (as "DATE") "1998-08-04") (interval "14" (day))))) (equal (ref "page_sk") (ref "cp_catalog_page_sk")))) (groupBy (ref "cp_catalog_page_id")))) (with (as "wsr") (query (select (ref "web_site_id") (as "sales") (function "sum" (ref "sales_price")) (as "profit") (function "sum" (ref "profit")) (as "returns") (function "sum" (ref "return_amt")) (as "profit_loss") (function "sum" (ref "net_loss"))) (from (join (join (aliasAs "salesreturns" (query (union (query (select (as "wsr_web_site_sk") (ref "ws_web_site_sk") (as "date_sk") (ref "ws_sold_date_sk") (as "sales_price") (ref "ws_ext_sales_price") (as "profit") (ref "ws_net_profit") (as "return_amt") (cast (as "DECIMAL(7,2)") 0) (as "net_loss") (cast (as "DECIMAL(7,2)") 0)) (from (table "web_sales"))) (query (select (as "wsr_web_site_sk") (ref "ws_web_site_sk") (as "date_sk") (ref "wr_returned_date_sk") (as "sales_price") (cast (as "DECIMAL(7,2)") 0) (as "profit") (cast (as "DECIMAL(7,2)") 0) (as "return_amt") (ref "wr_return_amt") (as "net_loss") (ref "wr_net_loss")) (from (join (left) (on (and (equal (ref "wr_item_sk") (ref "ws_item_sk")) (equal (ref "wr_order_number") (ref "ws_order_number")))) (table "web_returns") (table "web_sales"))))))) (table "date_dim")) (table "web_site"))) (where (and (and (equal (ref "date_sk") (ref "d_date_sk")) (isBetween (ref "d_date") (cast (as "DATE") "1998-08-04") (add (cast (as "DATE") "1998-08-04") (interval "14" (day))))) (equal (ref "wsr_web_site_sk") (ref "web_site_sk")))) (groupBy (ref "web_site_id")))) (select (ref "channel") (ref "id") (as "sales") (function "sum" (ref "sales")) (as "returns") (function "sum" (ref "returns")) (as "profit") (function "sum" (ref "profit"))) (from (aliasAs "x" (query (union (union (query (select (as "channel") "store channel" (as "id") (function "concat" "store" (ref "s_store_id")) (ref "sales") (ref "returns") (as "profit") (subtract (ref "profit") (ref "profit_loss"))) (from (table "ssr"))) (query (select (as "channel") "catalog channel" (as "id") (function "concat" "catalog_page" (ref "cp_catalog_page_id")) (ref "sales") (ref "returns") (as "profit") (subtract (ref "profit") (ref "profit_loss"))) (from (table "csr")))) (query (select (as "channel") "web channel" (as "id") (function "concat" "web_site" (ref "web_site_id")) (ref "sales") (ref "returns") (as "profit") (subtract (ref "profit") (ref "profit_loss"))) (from (table "wsr"))))))) (groupBy (rollup "channel" "id")) (orderBy (ascending (ref "channel")) (ascending (ref "id")))))
