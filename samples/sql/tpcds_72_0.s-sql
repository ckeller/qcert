(statements (query (select (ref "i_item_desc") (ref "w_warehouse_name") (deref "d_week_seq" (ref "d1")) (as "no_promo") (function "sum" (cases (case (when (isNull (ref "p_promo_sk"))) (then 1)) (default 0))) (as "promo") (function "sum" (cases (case (when (notNull (ref "p_promo_sk"))) (then 1)) (default 0))) (as "total_cnt") (function "count")) (from (join (left) (on (and (equal (ref "cr_item_sk") (ref "cs_item_sk")) (equal (ref "cr_order_number") (ref "cs_order_number")))) (join (left) (on (equal (ref "cs_promo_sk") (ref "p_promo_sk"))) (join (inner) (on (equal (ref "cs_ship_date_sk") (deref "d_date_sk" (ref "d3")))) (join (inner) (on (equal (ref "inv_date_sk") (deref "d_date_sk" (ref "d2")))) (join (inner) (on (equal (ref "cs_sold_date_sk") (deref "d_date_sk" (ref "d1")))) (join (inner) (on (equal (ref "cs_bill_hdemo_sk") (ref "hd_demo_sk"))) (join (inner) (on (equal (ref "cs_bill_cdemo_sk") (ref "cd_demo_sk"))) (join (inner) (on (equal (ref "i_item_sk") (ref "cs_item_sk"))) (join (inner) (on (equal (ref "w_warehouse_sk") (ref "inv_warehouse_sk"))) (join (inner) (on (equal (ref "cs_item_sk") (ref "inv_item_sk"))) (table "catalog_sales") (table "inventory")) (table "warehouse")) (table "item")) (table "customer_demographics")) (table "household_demographics")) (aliasAs "d1" (table "date_dim"))) (aliasAs "d2" (table "date_dim"))) (aliasAs "d3" (table "date_dim"))) (table "promotion")) (table "catalog_returns"))) (where (and (and (and (and (and (equal (deref "d_week_seq" (ref "d1")) (deref "d_week_seq" (ref "d2"))) (less_than (ref "inv_quantity_on_hand") (ref "cs_quantity"))) (greater_than (deref "d_date" (ref "d3")) (add (deref "d_date" (ref "d1")) 5))) (equal (ref "hd_buy_potential") "1001-5000")) (equal (deref "d_year" (ref "d1")) 2001)) (equal (ref "cd_marital_status") "M"))) (groupBy (ref "i_item_desc") (ref "w_warehouse_name") (deref "d_week_seq" (ref "d1"))) (orderBy (descending (ref "total_cnt")) (ascending (ref "i_item_desc")) (ascending (ref "w_warehouse_name")) (ascending (ref "d_week_seq")))))
