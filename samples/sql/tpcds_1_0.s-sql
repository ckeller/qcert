(statements (query (with (as "customer_total_return") (query (select (as "ctr_customer_sk") (ref "sr_customer_sk") (as "ctr_store_sk") (ref "sr_store_sk") (as "ctr_total_return") (function "sum" (ref "sr_fee"))) (from (join (table "store_returns") (table "date_dim"))) (where (and (equal (ref "sr_returned_date_sk") (ref "d_date_sk")) (equal (ref "d_year") 2000))) (groupBy (ref "sr_customer_sk") (ref "sr_store_sk")))) (select (ref "c_customer_id")) (from (join (join (aliasAs "ctr1" (table "customer_total_return")) (table "store")) (table "customer"))) (where (and (and (and (greater_than (deref "ctr_total_return" (ref "ctr1")) (query (select (multiply (function "avg" (ref "ctr_total_return")) 1.200000)) (from (aliasAs "ctr2" (table "customer_total_return"))) (where (equal (deref "ctr_store_sk" (ref "ctr1")) (deref "ctr_store_sk" (ref "ctr2")))))) (equal (ref "s_store_sk") (deref "ctr_store_sk" (ref "ctr1")))) (equal (ref "s_state") "TN")) (equal (deref "ctr_customer_sk" (ref "ctr1")) (ref "c_customer_sk")))) (orderBy (ascending (ref "c_customer_id")))))
