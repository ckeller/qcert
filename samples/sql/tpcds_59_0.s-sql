(statements (query (with (as "wss") (query (select (ref "d_week_seq") (ref "ss_store_sk") (as "sun_sales") (function "sum" (cases (case (when (equal (ref "d_day_name") "Sunday")) (then (ref "ss_sales_price"))) (default (dunit)))) (as "mon_sales") (function "sum" (cases (case (when (equal (ref "d_day_name") "Monday")) (then (ref "ss_sales_price"))) (default (dunit)))) (as "tue_sales") (function "sum" (cases (case (when (equal (ref "d_day_name") "Tuesday")) (then (ref "ss_sales_price"))) (default (dunit)))) (as "wed_sales") (function "sum" (cases (case (when (equal (ref "d_day_name") "Wednesday")) (then (ref "ss_sales_price"))) (default (dunit)))) (as "thu_sales") (function "sum" (cases (case (when (equal (ref "d_day_name") "Thursday")) (then (ref "ss_sales_price"))) (default (dunit)))) (as "fri_sales") (function "sum" (cases (case (when (equal (ref "d_day_name") "Friday")) (then (ref "ss_sales_price"))) (default (dunit)))) (as "sat_sales") (function "sum" (cases (case (when (equal (ref "d_day_name") "Saturday")) (then (ref "ss_sales_price"))) (default (dunit))))) (from (join (table "store_sales") (table "date_dim"))) (where (equal (ref "d_date_sk") (ref "ss_sold_date_sk"))) (groupBy (ref "d_week_seq") (ref "ss_store_sk")))) (select (ref "s_store_name1") (ref "s_store_id1") (ref "d_week_seq1") (divide (ref "sun_sales1") (ref "sun_sales2")) (divide (ref "mon_sales1") (ref "mon_sales2")) (divide (ref "tue_sales1") (ref "tue_sales2")) (divide (ref "wed_sales1") (ref "wed_sales2")) (divide (ref "thu_sales1") (ref "thu_sales2")) (divide (ref "fri_sales1") (ref "fri_sales2")) (divide (ref "sat_sales1") (ref "sat_sales2"))) (from (join (aliasAs "y" (query (select (as "s_store_name1") (ref "s_store_name") (as "d_week_seq1") (deref "d_week_seq" (ref "wss")) (as "s_store_id1") (ref "s_store_id") (as "sun_sales1") (ref "sun_sales") (as "mon_sales1") (ref "mon_sales") (as "tue_sales1") (ref "tue_sales") (as "wed_sales1") (ref "wed_sales") (as "thu_sales1") (ref "thu_sales") (as "fri_sales1") (ref "fri_sales") (as "sat_sales1") (ref "sat_sales")) (from (join (join (table "wss") (table "store")) (aliasAs "d" (table "date_dim")))) (where (and (and (equal (deref "d_week_seq" (ref "d")) (deref "d_week_seq" (ref "wss"))) (equal (ref "ss_store_sk") (ref "s_store_sk"))) (isBetween (ref "d_month_seq") 1185 (add 1185 11)))))) (aliasAs "x" (query (select (as "s_store_name2") (ref "s_store_name") (as "d_week_seq2") (deref "d_week_seq" (ref "wss")) (as "s_store_id2") (ref "s_store_id") (as "sun_sales2") (ref "sun_sales") (as "mon_sales2") (ref "mon_sales") (as "tue_sales2") (ref "tue_sales") (as "wed_sales2") (ref "wed_sales") (as "thu_sales2") (ref "thu_sales") (as "fri_sales2") (ref "fri_sales") (as "sat_sales2") (ref "sat_sales")) (from (join (join (table "wss") (table "store")) (aliasAs "d" (table "date_dim")))) (where (and (and (equal (deref "d_week_seq" (ref "d")) (deref "d_week_seq" (ref "wss"))) (equal (ref "ss_store_sk") (ref "s_store_sk"))) (isBetween (ref "d_month_seq") (add 1185 12) (add 1185 23)))))))) (where (and (equal (ref "s_store_id1") (ref "s_store_id2")) (equal (ref "d_week_seq1") (subtract (ref "d_week_seq2") 52)))) (orderBy (ascending (ref "s_store_name1")) (ascending (ref "s_store_id1")) (ascending (ref "d_week_seq1")))))
