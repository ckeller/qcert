(statements (query (with (as "ws") (query (select (as "ws_sold_year") (ref "d_year") (ref "ws_item_sk") (as "ws_customer_sk") (ref "ws_bill_customer_sk") (as "ws_qty") (function "sum" (ref "ws_quantity")) (as "ws_wc") (function "sum" (ref "ws_wholesale_cost")) (as "ws_sp") (function "sum" (ref "ws_sales_price"))) (from (join (inner) (on (equal (ref "ws_sold_date_sk") (ref "d_date_sk"))) (join (left) (on (and (equal (ref "wr_order_number") (ref "ws_order_number")) (equal (ref "ws_item_sk") (ref "wr_item_sk")))) (table "web_sales") (table "web_returns")) (table "date_dim"))) (where (isNull (ref "wr_order_number"))) (groupBy (ref "d_year") (ref "ws_item_sk") (ref "ws_bill_customer_sk")))) (with (as "cs") (query (select (as "cs_sold_year") (ref "d_year") (ref "cs_item_sk") (as "cs_customer_sk") (ref "cs_bill_customer_sk") (as "cs_qty") (function "sum" (ref "cs_quantity")) (as "cs_wc") (function "sum" (ref "cs_wholesale_cost")) (as "cs_sp") (function "sum" (ref "cs_sales_price"))) (from (join (inner) (on (equal (ref "cs_sold_date_sk") (ref "d_date_sk"))) (join (left) (on (and (equal (ref "cr_order_number") (ref "cs_order_number")) (equal (ref "cs_item_sk") (ref "cr_item_sk")))) (table "catalog_sales") (table "catalog_returns")) (table "date_dim"))) (where (isNull (ref "cr_order_number"))) (groupBy (ref "d_year") (ref "cs_item_sk") (ref "cs_bill_customer_sk")))) (with (as "ss") (query (select (as "ss_sold_year") (ref "d_year") (ref "ss_item_sk") (ref "ss_customer_sk") (as "ss_qty") (function "sum" (ref "ss_quantity")) (as "ss_wc") (function "sum" (ref "ss_wholesale_cost")) (as "ss_sp") (function "sum" (ref "ss_sales_price"))) (from (join (inner) (on (equal (ref "ss_sold_date_sk") (ref "d_date_sk"))) (join (left) (on (and (equal (ref "sr_ticket_number") (ref "ss_ticket_number")) (equal (ref "ss_item_sk") (ref "sr_item_sk")))) (table "store_sales") (table "store_returns")) (table "date_dim"))) (where (isNull (ref "sr_ticket_number"))) (groupBy (ref "d_year") (ref "ss_item_sk") (ref "ss_customer_sk")))) (select (ref "ss_sold_year") (ref "ss_item_sk") (ref "ss_customer_sk") (as "ratio") (function "round" (divide (ref "ss_qty") (coalesce (add (ref "ws_qty") (ref "cs_qty")) 1)) 2) (as "store_qty") (ref "ss_qty") (as "store_wholesale_cost") (ref "ss_wc") (as "store_sales_price") (ref "ss_sp") (as "other_chan_qty") (add (coalesce (ref "ws_qty") 0) (coalesce (ref "cs_qty") 0)) (as "other_chan_wholesale_cost") (add (coalesce (ref "ws_wc") 0) (coalesce (ref "cs_wc") 0)) (as "other_chan_sales_price") (add (coalesce (ref "ws_sp") 0) (coalesce (ref "cs_sp") 0))) (from (join (left) (on (and (and (equal (ref "cs_sold_year") (ref "ss_sold_year")) (equal (ref "cs_item_sk") (ref "cs_item_sk"))) (equal (ref "cs_customer_sk") (ref "ss_customer_sk")))) (join (left) (on (and (and (equal (ref "ws_sold_year") (ref "ss_sold_year")) (equal (ref "ws_item_sk") (ref "ss_item_sk"))) (equal (ref "ws_customer_sk") (ref "ss_customer_sk")))) (table "ss") (table "ws")) (table "cs"))) (where (and (and (greater_than (coalesce (ref "ws_qty") 0) 0) (greater_than (coalesce (ref "cs_qty") 0) 0)) (equal (ref "ss_sold_year") 2000))) (orderBy (ascending (ref "ss_sold_year")) (ascending (ref "ss_item_sk")) (ascending (ref "ss_customer_sk")) (descending (ref "ss_qty")) (descending (ref "ss_wc")) (descending (ref "ss_sp")) (ascending (ref "other_chan_qty")) (ascending (ref "other_chan_wholesale_cost")) (ascending (ref "other_chan_sales_price")) (ascending (function "round" (divide (ref "ss_qty") (coalesce (add (ref "ws_qty") (ref "cs_qty")) 1)) 2)))))
