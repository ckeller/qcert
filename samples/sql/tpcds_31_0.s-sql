(statements (query (with (as "ss") (query (select (ref "ca_county") (ref "d_qoy") (ref "d_year") (as "store_sales") (function "sum" (ref "ss_ext_sales_price"))) (from (join (join (table "store_sales") (table "date_dim")) (table "customer_address"))) (where (and (equal (ref "ss_sold_date_sk") (ref "d_date_sk")) (equal (ref "ss_addr_sk") (ref "ca_address_sk")))) (groupBy (ref "ca_county") (ref "d_qoy") (ref "d_year")))) (with (as "ws") (query (select (ref "ca_county") (ref "d_qoy") (ref "d_year") (as "web_sales") (function "sum" (ref "ws_ext_sales_price"))) (from (join (join (table "web_sales") (table "date_dim")) (table "customer_address"))) (where (and (equal (ref "ws_sold_date_sk") (ref "d_date_sk")) (equal (ref "ws_bill_addr_sk") (ref "ca_address_sk")))) (groupBy (ref "ca_county") (ref "d_qoy") (ref "d_year")))) (select (deref "ca_county" (ref "ss1")) (deref "d_year" (ref "ss1")) (as "web_q1_q2_increase") (divide (deref "web_sales" (ref "ws2")) (deref "web_sales" (ref "ws1"))) (as "store_q1_q2_increase") (divide (deref "store_sales" (ref "ss2")) (deref "store_sales" (ref "ss1"))) (as "web_q2_q3_increase") (divide (deref "web_sales" (ref "ws3")) (deref "web_sales" (ref "ws2"))) (as "store_q2_q3_increase") (divide (deref "store_sales" (ref "ss3")) (deref "store_sales" (ref "ss2")))) (from (join (join (join (join (join (aliasAs "ss1" (table "ss")) (aliasAs "ss2" (table "ss"))) (aliasAs "ss3" (table "ss"))) (aliasAs "ws1" (table "ws"))) (aliasAs "ws2" (table "ws"))) (aliasAs "ws3" (table "ws")))) (where (and (and (and (and (and (and (and (and (and (and (and (and (and (and (and (and (and (and (equal (deref "d_qoy" (ref "ss1")) 1) (equal (deref "d_year" (ref "ss1")) 2000)) (equal (deref "ca_county" (ref "ss1")) (deref "ca_county" (ref "ss2")))) (equal (deref "d_qoy" (ref "ss2")) 2)) (equal (deref "d_year" (ref "ss2")) 2000)) (equal (deref "ca_county" (ref "ss2")) (deref "ca_county" (ref "ss3")))) (equal (deref "d_qoy" (ref "ss3")) 3)) (equal (deref "d_year" (ref "ss3")) 2000)) (equal (deref "ca_county" (ref "ss1")) (deref "ca_county" (ref "ws1")))) (equal (deref "d_qoy" (ref "ws1")) 1)) (equal (deref "d_year" (ref "ws1")) 2000)) (equal (deref "ca_county" (ref "ws1")) (deref "ca_county" (ref "ws2")))) (equal (deref "d_qoy" (ref "ws2")) 2)) (equal (deref "d_year" (ref "ws2")) 2000)) (equal (deref "ca_county" (ref "ws1")) (deref "ca_county" (ref "ws3")))) (equal (deref "d_qoy" (ref "ws3")) 3)) (equal (deref "d_year" (ref "ws3")) 2000)) (greater_than (cases (case (when (greater_than (deref "web_sales" (ref "ws1")) 0)) (then (divide (deref "web_sales" (ref "ws2")) (deref "web_sales" (ref "ws1"))))) (default (dunit))) (cases (case (when (greater_than (deref "store_sales" (ref "ss1")) 0)) (then (divide (deref "store_sales" (ref "ss2")) (deref "store_sales" (ref "ss1"))))) (default (dunit))))) (greater_than (cases (case (when (greater_than (deref "web_sales" (ref "ws2")) 0)) (then (divide (deref "web_sales" (ref "ws3")) (deref "web_sales" (ref "ws2"))))) (default (dunit))) (cases (case (when (greater_than (deref "store_sales" (ref "ss2")) 0)) (then (divide (deref "store_sales" (ref "ss3")) (deref "store_sales" (ref "ss2"))))) (default (dunit)))))) (orderBy (ascending (deref "d_year" (ref "ss1"))))))
