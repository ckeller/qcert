(statements (query (with (as "all_sales") (query (select (ref "d_year") (ref "i_brand_id") (ref "i_class_id") (ref "i_category_id") (ref "i_manufact_id") (as "sales_cnt") (function "sum" (ref "sales_cnt")) (as "sales_amt") (function "sum" (ref "sales_amt"))) (from (aliasAs "sales_detail" (query (union (distinct) (union (distinct) (query (select (ref "d_year") (ref "i_brand_id") (ref "i_class_id") (ref "i_category_id") (ref "i_manufact_id") (as "sales_cnt") (subtract (ref "cs_quantity") (coalesce (ref "cr_return_quantity") 0)) (as "sales_amt") (subtract (ref "cs_ext_sales_price") (coalesce (ref "cr_return_amount") 0))) (from (join (left) (on (and (equal (ref "cs_order_number") (ref "cr_order_number")) (equal (ref "cs_item_sk") (ref "cr_item_sk")))) (join (inner) (on (equal (ref "d_date_sk") (ref "cs_sold_date_sk"))) (join (inner) (on (equal (ref "i_item_sk") (ref "cs_item_sk"))) (table "catalog_sales") (table "item")) (table "date_dim")) (table "catalog_returns"))) (where (equal (ref "i_category") "Sports"))) (query (select (ref "d_year") (ref "i_brand_id") (ref "i_class_id") (ref "i_category_id") (ref "i_manufact_id") (as "sales_cnt") (subtract (ref "ss_quantity") (coalesce (ref "sr_return_quantity") 0)) (as "sales_amt") (subtract (ref "ss_ext_sales_price") (coalesce (ref "sr_return_amt") 0))) (from (join (left) (on (and (equal (ref "ss_ticket_number") (ref "sr_ticket_number")) (equal (ref "ss_item_sk") (ref "sr_item_sk")))) (join (inner) (on (equal (ref "d_date_sk") (ref "ss_sold_date_sk"))) (join (inner) (on (equal (ref "i_item_sk") (ref "ss_item_sk"))) (table "store_sales") (table "item")) (table "date_dim")) (table "store_returns"))) (where (equal (ref "i_category") "Sports")))) (query (select (ref "d_year") (ref "i_brand_id") (ref "i_class_id") (ref "i_category_id") (ref "i_manufact_id") (as "sales_cnt") (subtract (ref "ws_quantity") (coalesce (ref "wr_return_quantity") 0)) (as "sales_amt") (subtract (ref "ws_ext_sales_price") (coalesce (ref "wr_return_amt") 0))) (from (join (left) (on (and (equal (ref "ws_order_number") (ref "wr_order_number")) (equal (ref "ws_item_sk") (ref "wr_item_sk")))) (join (inner) (on (equal (ref "d_date_sk") (ref "ws_sold_date_sk"))) (join (inner) (on (equal (ref "i_item_sk") (ref "ws_item_sk"))) (table "web_sales") (table "item")) (table "date_dim")) (table "web_returns"))) (where (equal (ref "i_category") "Sports"))))))) (groupBy (ref "d_year") (ref "i_brand_id") (ref "i_class_id") (ref "i_category_id") (ref "i_manufact_id")))) (select (as "prev_year") (deref "d_year" (ref "prev_yr")) (as "year") (deref "d_year" (ref "curr_yr")) (deref "i_brand_id" (ref "curr_yr")) (deref "i_class_id" (ref "curr_yr")) (deref "i_category_id" (ref "curr_yr")) (deref "i_manufact_id" (ref "curr_yr")) (as "prev_yr_cnt") (deref "sales_cnt" (ref "prev_yr")) (as "curr_yr_cnt") (deref "sales_cnt" (ref "curr_yr")) (as "sales_cnt_diff") (subtract (deref "sales_cnt" (ref "curr_yr")) (deref "sales_cnt" (ref "prev_yr"))) (as "sales_amt_diff") (subtract (deref "sales_amt" (ref "curr_yr")) (deref "sales_amt" (ref "prev_yr")))) (from (join (aliasAs "curr_yr" (table "all_sales")) (aliasAs "prev_yr" (table "all_sales")))) (where (and (and (and (and (and (and (equal (deref "i_brand_id" (ref "curr_yr")) (deref "i_brand_id" (ref "prev_yr"))) (equal (deref "i_class_id" (ref "curr_yr")) (deref "i_class_id" (ref "prev_yr")))) (equal (deref "i_category_id" (ref "curr_yr")) (deref "i_category_id" (ref "prev_yr")))) (equal (deref "i_manufact_id" (ref "curr_yr")) (deref "i_manufact_id" (ref "prev_yr")))) (equal (deref "d_year" (ref "curr_yr")) 2002)) (equal (deref "d_year" (ref "prev_yr")) (subtract 2002 1))) (less_than (divide (cast (as "DECIMAL(17,2)") (deref "sales_cnt" (ref "curr_yr"))) (cast (as "DECIMAL(17,2)") (deref "sales_cnt" (ref "prev_yr")))) 0.900000))) (orderBy (ascending (ref "sales_cnt_diff")))))
