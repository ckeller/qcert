(statements (query (select (ref "ss_customer_sk") (as "sumsales") (function "sum" (ref "act_sales"))) (from (aliasAs "t" (query (select (ref "ss_item_sk") (ref "ss_ticket_number") (ref "ss_customer_sk") (as "act_sales") (cases (case (when (notNull (ref "sr_return_quantity"))) (then (multiply (subtract (ref "ss_quantity") (ref "sr_return_quantity")) (ref "ss_sales_price")))) (default (multiply (ref "ss_quantity") (ref "ss_sales_price"))))) (from (join (join (left) (on (and (equal (ref "sr_item_sk") (ref "ss_item_sk")) (equal (ref "sr_ticket_number") (ref "ss_ticket_number")))) (table "store_sales") (table "store_returns")) (table "reason"))) (where (and (equal (ref "sr_reason_sk") (ref "r_reason_sk")) (equal (ref "r_reason_desc") "Did not like the warranty")))))) (groupBy (ref "ss_customer_sk")) (orderBy (ascending (ref "sumsales")) (ascending (ref "ss_customer_sk")))))
