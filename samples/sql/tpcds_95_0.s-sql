(statements (query (with (as "ws_wh") (query (select (deref "ws_order_number" (ref "ws1")) (as "wh1") (deref "ws_warehouse_sk" (ref "ws1")) (as "wh2") (deref "ws_warehouse_sk" (ref "ws2"))) (from (join (aliasAs "ws1" (table "web_sales")) (aliasAs "ws2" (table "web_sales")))) (where (and (equal (deref "ws_order_number" (ref "ws1")) (deref "ws_order_number" (ref "ws2"))) (not_equal (deref "ws_warehouse_sk" (ref "ws1")) (deref "ws_warehouse_sk" (ref "ws2"))))))) (select (as "order count") (function "count" (ref "ws_order_number")) (as "total shipping cost") (function "sum" (ref "ws_ext_ship_cost")) (as "total net profit") (function "sum" (ref "ws_net_profit"))) (from (join (join (join (aliasAs "ws1" (table "web_sales")) (table "date_dim")) (table "customer_address")) (table "web_site"))) (where (and (and (and (and (and (and (and (isBetween (ref "d_date") "1999-5-01" (add (cast (as "DATE") "1999-5-01") (interval "60" (day)))) (equal (deref "ws_ship_date_sk" (ref "ws1")) (ref "d_date_sk"))) (equal (deref "ws_ship_addr_sk" (ref "ws1")) (ref "ca_address_sk"))) (equal (ref "ca_state") "TX")) (equal (deref "ws_web_site_sk" (ref "ws1")) (ref "web_site_sk"))) (equal (ref "web_company_name") "pri")) (isIn (deref "ws_order_number" (ref "ws1")) (query (select (ref "ws_order_number")) (from (table "ws_wh"))))) (isIn (deref "ws_order_number" (ref "ws1")) (query (select (ref "wr_order_number")) (from (join (table "web_returns") (table "ws_wh"))) (where (equal (ref "wr_order_number") (deref "ws_order_number" (ref "ws_wh")))))))) (orderBy (ascending (function "count" (ref "ws_order_number"))))))
