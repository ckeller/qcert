(statements (query (with (as "web_v1") (query (select (as "item_sk") (ref "ws_item_sk") (ref "d_date") (as "cume_sales") (function (orderBy (ascending (ref "d_date"))) (partitionBy (ref "ws_item_sk")) (frame (rows) (frameBound (unbounded_preceding)) (frameBound (current_row))) "sum" (function "sum" (ref "ws_sales_price")))) (from (join (table "web_sales") (table "date_dim"))) (where (and (and (equal (ref "ws_sold_date_sk") (ref "d_date_sk")) (isBetween (ref "d_month_seq") 1212 (add 1212 11))) (notNull (ref "ws_item_sk")))) (groupBy (ref "ws_item_sk") (ref "d_date")))) (with (as "store_v1") (query (select (as "item_sk") (ref "ss_item_sk") (ref "d_date") (as "cume_sales") (function (orderBy (ascending (ref "d_date"))) (partitionBy (ref "ss_item_sk")) (frame (rows) (frameBound (unbounded_preceding)) (frameBound (current_row))) "sum" (function "sum" (ref "ss_sales_price")))) (from (join (table "store_sales") (table "date_dim"))) (where (and (and (equal (ref "ss_sold_date_sk") (ref "d_date_sk")) (isBetween (ref "d_month_seq") 1212 (add 1212 11))) (notNull (ref "ss_item_sk")))) (groupBy (ref "ss_item_sk") (ref "d_date")))) (select (all)) (from (aliasAs "y" (query (select (ref "item_sk") (ref "d_date") (ref "web_sales") (ref "store_sales") (as "web_cumulative") (function (orderBy (ascending (ref "d_date"))) (partitionBy (ref "item_sk")) (frame (rows) (frameBound (unbounded_preceding)) (frameBound (current_row))) "max" (ref "web_sales")) (as "store_cumulative") (function (orderBy (ascending (ref "d_date"))) (partitionBy (ref "item_sk")) (frame (rows) (frameBound (unbounded_preceding)) (frameBound (current_row))) "max" (ref "store_sales"))) (from (aliasAs "x" (query (select (as "item_sk") (cases (case (when (notNull (deref "item_sk" (ref "web")))) (then (deref "item_sk" (ref "web")))) (default (deref "item_sk" (ref "store")))) (as "d_date") (cases (case (when (notNull (deref "d_date" (ref "web")))) (then (deref "d_date" (ref "web")))) (default (deref "d_date" (ref "store")))) (as "web_sales") (deref "cume_sales" (ref "web")) (as "store_sales") (deref "cume_sales" (ref "store"))) (from (join (full) (on (and (equal (deref "item_sk" (ref "web")) (deref "item_sk" (ref "store"))) (equal (deref "d_date" (ref "web")) (deref "d_date" (ref "store"))))) (aliasAs "web" (table "web_v1")) (aliasAs "store" (table "store_v1")))))))))) (where (greater_than (ref "web_cumulative") (ref "store_cumulative"))) (orderBy (ascending (ref "item_sk")) (ascending (ref "d_date")))))
