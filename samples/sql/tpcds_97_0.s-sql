(statements (query (with (as "ssci") (query (select (as "customer_sk") (ref "ss_customer_sk") (as "item_sk") (ref "ss_item_sk")) (from (join (table "store_sales") (table "date_dim"))) (where (and (equal (ref "ss_sold_date_sk") (ref "d_date_sk")) (isBetween (ref "d_month_seq") 1212 (add 1212 11)))) (groupBy (ref "ss_customer_sk") (ref "ss_item_sk")))) (with (as "csci") (query (select (as "customer_sk") (ref "cs_bill_customer_sk") (as "item_sk") (ref "cs_item_sk")) (from (join (table "catalog_sales") (table "date_dim"))) (where (and (equal (ref "cs_sold_date_sk") (ref "d_date_sk")) (isBetween (ref "d_month_seq") 1212 (add 1212 11)))) (groupBy (ref "cs_bill_customer_sk") (ref "cs_item_sk")))) (select (as "store_only") (function "sum" (cases (case (when (and (notNull (deref "customer_sk" (ref "ssci"))) (isNull (deref "customer_sk" (ref "csci"))))) (then 1)) (default 0))) (as "catalog_only") (function "sum" (cases (case (when (and (isNull (deref "customer_sk" (ref "ssci"))) (notNull (deref "customer_sk" (ref "csci"))))) (then 1)) (default 0))) (as "store_and_catalog") (function "sum" (cases (case (when (and (notNull (deref "customer_sk" (ref "ssci"))) (notNull (deref "customer_sk" (ref "csci"))))) (then 1)) (default 0)))) (from (join (full) (on (and (equal (deref "customer_sk" (ref "ssci")) (deref "customer_sk" (ref "csci"))) (equal (deref "item_sk" (ref "ssci")) (deref "item_sk" (ref "csci"))))) (table "ssci") (table "csci")))))
