(statements (query (select (ref "promotions") (ref "total") (multiply (divide (cast (as "DECIMAL(15,4)") (ref "promotions")) (cast (as "DECIMAL(15,4)") (ref "total"))) 100)) (from (join (aliasAs "promotional_sales" (query (select (as "promotions") (function "sum" (ref "ss_ext_sales_price"))) (from (join (join (join (join (join (join (table "store_sales") (table "store")) (table "promotion")) (table "date_dim")) (table "customer")) (table "customer_address")) (table "item"))) (where (and (and (and (and (and (and (and (and (and (and (and (equal (ref "ss_sold_date_sk") (ref "d_date_sk")) (equal (ref "ss_store_sk") (ref "s_store_sk"))) (equal (ref "ss_promo_sk") (ref "p_promo_sk"))) (equal (ref "ss_customer_sk") (ref "c_customer_sk"))) (equal (ref "ca_address_sk") (ref "c_current_addr_sk"))) (equal (ref "ss_item_sk") (ref "i_item_sk"))) (equal (ref "ca_gmt_offset") (minus 7))) (equal (ref "i_category") "Books")) (or (or (equal (ref "p_channel_dmail") "Y") (equal (ref "p_channel_email") "Y")) (equal (ref "p_channel_tv") "Y"))) (equal (ref "s_gmt_offset") (minus 7))) (equal (ref "d_year") 1999)) (equal (ref "d_moy") 11))))) (aliasAs "all_sales" (query (select (as "total") (function "sum" (ref "ss_ext_sales_price"))) (from (join (join (join (join (join (table "store_sales") (table "store")) (table "date_dim")) (table "customer")) (table "customer_address")) (table "item"))) (where (and (and (and (and (and (and (and (and (and (equal (ref "ss_sold_date_sk") (ref "d_date_sk")) (equal (ref "ss_store_sk") (ref "s_store_sk"))) (equal (ref "ss_customer_sk") (ref "c_customer_sk"))) (equal (ref "ca_address_sk") (ref "c_current_addr_sk"))) (equal (ref "ss_item_sk") (ref "i_item_sk"))) (equal (ref "ca_gmt_offset") (minus 7))) (equal (ref "i_category") "Books")) (equal (ref "s_gmt_offset") (minus 7))) (equal (ref "d_year") 1999)) (equal (ref "d_moy") 11))))))) (orderBy (ascending (ref "promotions")) (ascending (ref "total")))))
