(statements (query (select (ref "s_store_name") (ref "i_item_desc") (deref "revenue" (ref "sc")) (ref "i_current_price") (ref "i_wholesale_cost") (ref "i_brand")) (from (join (join (join (table "store") (table "item")) (aliasAs "sb" (query (select (ref "ss_store_sk") (as "ave") (function "avg" (ref "revenue"))) (from (aliasAs "sa" (query (select (ref "ss_store_sk") (ref "ss_item_sk") (as "revenue") (function "sum" (ref "ss_sales_price"))) (from (join (table "store_sales") (table "date_dim"))) (where (and (equal (ref "ss_sold_date_sk") (ref "d_date_sk")) (isBetween (ref "d_month_seq") 1212 (add 1212 11)))) (groupBy (ref "ss_store_sk") (ref "ss_item_sk"))))) (groupBy (ref "ss_store_sk"))))) (aliasAs "sc" (query (select (ref "ss_store_sk") (ref "ss_item_sk") (as "revenue") (function "sum" (ref "ss_sales_price"))) (from (join (table "store_sales") (table "date_dim"))) (where (and (equal (ref "ss_sold_date_sk") (ref "d_date_sk")) (isBetween (ref "d_month_seq") 1212 (add 1212 11)))) (groupBy (ref "ss_store_sk") (ref "ss_item_sk")))))) (where (and (and (and (equal (deref "ss_store_sk" (ref "sb")) (deref "ss_store_sk" (ref "sc"))) (less_than_or_equal (deref "revenue" (ref "sc")) (multiply 0.100000 (deref "ave" (ref "sb"))))) (equal (ref "s_store_sk") (deref "ss_store_sk" (ref "sc")))) (equal (ref "i_item_sk") (deref "ss_item_sk" (ref "sc"))))) (orderBy (ascending (ref "s_store_name")) (ascending (ref "i_item_desc")))))
